<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.0.1">
    <title>管理员主页</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/dashboard/">

    <!-- Bootstrap core CSS -->
    <link href="../css/administrators/reportAdmin.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://lib.baomitu.com/font-awesome/5.11.2/css/all.min.css">
    <script type="text/javascript" src="https://lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://lib.baomitu.com/vue/2.6.10/vue.min.js"></script>

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
    <!-- Custom styles for this template -->
    <link href="dashboard.css" rel="stylesheet">
</head>
<body>
<div id="reportAdmin">
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">IKnow</a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <input class="form-control form-control-dark w-100" type="text" placeholder="搜索" aria-label="Search">
        <ul class="navbar-nav px-5">
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="#">搜索</a>
            </li>
        </ul>
        <ul class="navbar-nav px-3" style="background-color: crimson">
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="#" @click="logout">登出</a>
            </li>
        </ul>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="sidebar-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>举报管理</span>
                        <!--                    <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">-->
                        <!--                        <span data-feather="plus-circle"></span>-->
                        <!--                    </a>-->
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span data-feather="book"></span>
                                问题举报
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <span data-feather="feather"></span>
                                回答举报
                                <span class="badge badge-pill badge-dark" v-if="reportInfoList.length>0">{{reportInfoList.length}}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span data-feather="message-circle"></span>
                                评论举报
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span data-feather="refresh-cw"></span>
                                回复举报
                            </a>
                        </li>
                    </ul>
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学校认证管理</span>
                        <!--                    <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">-->
                        <!--                        <span data-feather="plus-circle"></span>-->
                        <!--                    </a>-->
                    </h6>
                    <ul class="nav flex-column mb-2">
                        <li class="nav-item">
                            <a class="nav-link" href="statisticsUserAdmin.html">
                                <span data-feather="check-circle"></span>
                                学校认证管理
                            </a>
                        </li>
                    </ul>
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>相关统计</span>
                        <!--                    <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">-->
                        <!--                        <span data-feather="plus-circle"></span>-->
                        <!--                    </a>-->
                    </h6>
                    <ul class="nav flex-column mb-2">
                        <li class="nav-item">
                            <a class="nav-link" href="statisticsUserAdmin.html">
                                <span data-feather="users"></span>
                                用户统计
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="statisticsQuestionAdmin.html">
                                <span data-feather="book"></span>
                                问题统计
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">举报管理</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group mr-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary">导出</button>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                            <span data-feather="calendar"></span>
                            This week
                        </button>
                    </div>
                </div>
                <!--            <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>-->
                <h2>回答举报管理</h2>
                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead align="center">
                        <tr>
                            <th>举报ID</th>
                            <th>举报者ID</th>
                            <th>被举报者ID</th>
                            <th>举报类别</th>
                            <th>举报日期</th>
                            <th>原因类别</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody align="center">
                        <tr v-for="(reportInfo,i) in subArr">
                            <td>{{reportInfo.id}}</td>
                            <td>{{reportInfo.userID}}</td>
                            <td>{{reportInfo.targetID}}</td>
                            <td>{{reportInfo.type}}</td>
                            <td>{{reportInfo.date}}</td>
                            <td>{{reportInfo.reason}}</td>
                            <td>
                                <button @click="now=i+(cur-1)*15" class="btn btn-primary btn-sm" data-toggle="modal" onclick="displayWindow()">处理</button>&nbsp;&nbsp;&nbsp;&nbsp;
                                <button @click="now=i+(cur-1)*15" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#layer">删除</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="page-bar">
                        <ul>
                            <li v-if="cur>1"><a v-on:click="cur=1,pageClick()">首页</a></li>
                            <li v-if="cur==1"><a class="banclick">首页</a></li>
                            <li v-if="cur>1"><a v-on:click="cur--,pageClick()">上一页</a></li>
                            <li v-if="cur==1"><a class="banclick">上一页</a></li>
                            <!--当前页背景色为蓝色-->
                            <li v-for="index in indexs"  v-bind:class="{ 'active': cur == index}">
                                <a v-on:click="btnClick(index)">{{ index }}</a>
                            </li>
                            <li v-if="cur<all"><a v-on:click="cur++,pageClick()">下一页</a></li>
                            <li v-if="cur == all"><a class="banclick">下一页</a></li>
                            <li v-if="cur<all"><a v-on:click="cur=all,pageClick()">尾页</a></li>
                            <li v-if="cur == all"><a class="banclick">尾页</a></li>
                            <li><a>共<i>{{all}}</i>页</a></li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
        <div role="dialog" class="modal fade bs-example-modal-sm" id="layer">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">{{ '确认删除么？'}} </h4>
                    </div>
                    <div class="modal-body text-right">
                        <button data-dismiss="modal" class="btn btn-primary btn-sm">取消</button>
                        <button data-dismiss="modal" class="btn btn-danger btn-sm" @click="del()">确认</button>
                    </div>
                </div>
            </div>
        </div>
        <!--悬浮窗口-->
        <div id="window" class="window_css" style="background-color: white">
            <div>
                <span style="font-size: 1.2em;font-weight: bold">用户信息</span>
                <a href="javascript:void(0)" onclick="hideWindow()">
                    <i class="fas fa-times" style="font-size: 2em;position:absolute;right: 0"></i>
                </a>
            </div>
            <div class="userInfo">
                <h5>基本信息：</h5>
                <div class="form-row">
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="ID:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <input type="number" readonly class="form-control-plaintext" value="1">
                    </div>
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="用户名:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <input type="password" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="个人介绍:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <input type="text" class="form-control" value="春翔的父亲">
                    </div>
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="性别:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <select id="inputState" class="form-control">
                            <option selected>保密</option>
                            <option>男/option>
                            <option>女/option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="用户身份:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <select class="form-control">
                            <option selected>学生</option>
                            <option>老师</option>
                        </select>
                    </div>
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="用户状态:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <select class="form-control">
                            <option selected>正常</option>
                            <option>停封</option>
                            <option>禁言</option>
                        </select>
                    </div>
                </div>
                <h5>设置账户密码：</h5>
                <div class="form-row">
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="邮箱:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <input type="email" class="form-control" value="1185229277@qq.com">
                    </div>
                    <div class="form-group col-1">
                        <input type="text" readonly class="form-control-plaintext" value="密码:" style="text-align: center;font-weight: bold">
                    </div>
                    <div class="form-group col-4">
                        <input type="text" class="form-control" value="123456">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">保存</button>
                <button type="submit" class="btn btn-danger">删除</button>
            </div>
        </div>
        <!--出现悬浮窗口后,背景变暗-->
        <div id="shadow" class="shadow_css"></div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<script>
    /*当点击调用此方法后,将悬浮窗口显示出来,背景变暗*/
    function displayWindow() {
        /*悬浮窗口的显示,需要将display变成block*/
        document.getElementById("window").style.display = "block";
        /*将背景变暗*/
        document.getElementById("shadow").style.display = "block";
    }
    /*当点击调用此方法,将悬浮窗口和背景全部隐藏*/
    function hideWindow() {
        document.getElementById("window").style.display = "none";
        document.getElementById("shadow").style.display = "none";
    }
    let reportAdmin=new Vue({
        el:"#reportAdmin",
        data:{
            reportInfoList:[],
            pageInfoList:[],
            isRmb:false,
            accountNumError:false,
            accountNumErrorMsg:"",
            passwordError:false,
            passwordErrorMsg:"",
            alertMsg:{head:"",body:""},
            all: 1, //总页数
            cur: 1,//当前页码
            now:-1//当前索引
        },
        watch: {
            cur: function(oldValue , newValue){
                console.log(arguments);
            }
        },
        methods:{
            logout:function () {
                $.ajax({
                    type:"POST",
                    url:"../admin/logout.action",
                    data:{},
                    dataType:"json",
                    success:function (result) {
                        if (result.response === 0) {
                            location.href = "login.html";
                        }
                    },
                    error:function (request,status,error) {
                        alert("系统异常！");
                        console.log(request.status);
                        console.log(request.readyState);
                        console.log(status);
                    }
                });
            },
            isLogin:function(){
                $.ajax({
                    url: "../admin/isLogin.action",
                    type: "POST",
                    data: {},
                    dataType: "json",
                    success: function (result) {
                        if (result.resultCode === 1) {
                            location.href="login.html";
                        }
                    },
                    error: function (request, status, error) {
                        alert("系统异常！");
                        console.log(request.status);
                        console.log(request.readyState);
                        console.log(status);
                    }
                });
            },
            getReportType: function(reportType){
                $.ajax({
                    type:"POST",
                    url:"../admin/reportType.action",
                    data:{
                        reportType:reportType,
                    },
                    dataType:"json",
                    success:function (result) {
                        if (result.resultCode === 0) {
                            reportAdmin.reportInfoList = result.reportInfoList;
                            reportAdmin.all = Math.ceil(reportAdmin.reportInfoList.length/15) || 1;
                            console.log(reportAdmin.all);
                            for(let i = 0;i < reportAdmin.reportInfoList.length;i++)
                            {
                                reportAdmin.pageInfoList[i] = reportAdmin.reportInfoList.slice(15*i,15*(i+1));
                                console.log(reportAdmin.pageInfoList[i]);
                            }
                        }
                    },
                    error:function (request,status,error) {
                        alert("系统异常！");
                        console.log(request.status);
                        console.log(request.readyState);
                        console.log(status);
                    }
                });
            },
            del: function(){
                $.ajax({
                    type:"POST",
                    url:"../admin/reportDel.action",
                    data:{
                        reportID:reportAdmin.reportInfoList[reportAdmin.now].id,
                    },
                    dataType:"json",
                    success:function (result) {
                        if (result.resultCode === 0) {
                            reportAdmin.reportInfoList.splice(reportAdmin.now,1);
                            if((reportAdmin.reportInfoList.length+1)%15==1&&reportAdmin.cur==reportAdmin.all){
                                reportAdmin.cur--;
                            }   //当最后一页的最后一条数据被删除时，也要改变当前页面
                            reportAdmin.page();
                            console.log(reportAdmin.now);
                        }
                    },
                    error:function (request,status,error) {
                        alert("系统异常！");
                        console.log(request.status);
                        console.log(request.readyState);
                        console.log(status);
                    }
                });
            },
            page: function(){
                reportAdmin.all = Math.ceil(reportAdmin.reportInfoList.length/15) || 1;
                console.log(reportAdmin.all);
            },
            btnClick: function(data){
                if(data != this.cur){
                    this.cur = data;
                    // reportAdmin.reportInfoList = reportAdmin.pageInfoList[this.cur-1];
                }
            },
            pageClick: function(){
                console.log('现在在'+this.cur+'页');
                // reportAdmin.reportInfoList = reportAdmin.pageInfoList[this.cur-1];
            }
        },
        computed: {
            indexs: function(){
                var left = 1;
                var right = this.all;
                var ar = [];
                if(this.all>= 5){
                    //这里最大范围从3到6，如果到达7，那么下边加2变成9，已经超过最大的范围值
                    if(this.cur > 3 && this.cur < this.all-1){
                        //以4为参考基准，左面加2右边加2
                        left = this.cur - 2
                        right = this.cur + 2
                    }else{
                        if(this.cur<=3){
                            left = 1
                            right = 5
                        }else{
                            right = this.all
                            left = this.all -4
                        }
                    }
                }
                while (left <= right){
                    ar.push(left)
                    left ++
                }
                console.log(ar);
                return ar
            },
            subArr() {
                console.log(this.reportInfoList.slice((this.cur-1)*15,this.cur*15));
                return this.reportInfoList.slice((this.cur-1)*15,this.cur*15);
            }
        },
        mounted:function () {
            this.isLogin();
            this.getReportType(1);
        }
    });
    (function () {
        'use strict'
        feather.replace()
        // Graphs
        var ctx = document.getElementById('myChart')
        // eslint-disable-next-line no-unused-vars
    }())
</script>
</body>
</html>
